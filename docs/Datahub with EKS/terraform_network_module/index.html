<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/til/blog/rss.xml" title="Wonjun&#39;s Today I Learned RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/til/blog/atom.xml" title="Wonjun&#39;s Today I Learned Atom Feed"><title data-react-helmet="true">EKS Datahub 3 Terraform Network Module | Wonjun&#x27;s Today I Learned</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wonjun0120/github.io/til/docs/Datahub with EKS/terraform_network_module"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="EKS Datahub 3 Terraform Network Module | Wonjun&#x27;s Today I Learned"><meta data-react-helmet="true" name="description" content="Tags: aib-datateam, aws, datahub, eks, engineering-log, kubernetes, terraform, traefik"><meta data-react-helmet="true" property="og:description" content="Tags: aib-datateam, aws, datahub, eks, engineering-log, kubernetes, terraform, traefik"><link data-react-helmet="true" rel="icon" href="/til/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wonjun0120/github.io/til/docs/Datahub with EKS/terraform_network_module"><link data-react-helmet="true" rel="alternate" href="https://wonjun0120/github.io/til/docs/Datahub with EKS/terraform_network_module" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wonjun0120/github.io/til/docs/Datahub with EKS/terraform_network_module" hreflang="x-default"><link rel="stylesheet" href="/til/assets/css/styles.8d002642.css">
<link rel="preload" href="/til/assets/js/runtime~main.2dd48f90.js" as="script">
<link rel="preload" href="/til/assets/js/main.7dcddf2a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/til/"><b class="navbar__title">Wonjun&#x27;s TIL</b></a><a class="navbar__item navbar__link navbar__link--active" href="/til/docs/intro">Project Logs</a><a class="navbar__item navbar__link" href="/til/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wonjun0120" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/til/docs/intro">Project Log</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/til/docs/Datahub with EKS/aws_setting">Datahub with EKS</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/til/docs/Datahub with EKS/aws_setting">EKS Datahub 1 AWS Setting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/til/docs/Datahub with EKS/terraform_basic_setting">EKS Datahub 2 Terraform 초기 세팅</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/til/docs/Datahub with EKS/terraform_network_module">EKS Datahub 3 Terraform Network Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/til/docs/Datahub with EKS/terraform_eks_module">EKS Datahub 4 Terraform EKS Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/til/docs/Datahub with EKS/terraform_argocd_module">EKS Datahub 5 Terraform ArgoCD Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/til/docs/Datahub with EKS/argocd_deploy">EKS Datahub 6 ArgoCD로 Datahub 배포</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>EKS - Datahub - 3 Terraform Network Module</h1></header><p>Tags: aib-datateam, aws, datahub, eks, engineering-log, kubernetes, terraform, traefik</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="래퍼런스">래퍼런스<a class="hash-link" href="#래퍼런스" title="Direct link to heading">​</a></h3><p>여기서부터는 아래 책을 바탕으로 진행하였습니다. </p><p><a href="http://www.yes24.com/Product/Goods/102805240" target="_blank" rel="noopener noreferrer">처음 시작하는 마이크로서비스 - YES24</a></p><p>Terraform, EKS, Traefik, Argocd 등 전반적으로 다 알려주고 있습니다!
혹시나 관심있으신 분들은 꼭 읽어보시는 것을 추천드립니다!</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="network-들어가기-앞서">Network 들어가기 앞서..<a class="hash-link" href="#network-들어가기-앞서" title="Direct link to heading">​</a></h3><p>EKS를 본격적으로 생성하기 전에 EKS에 대해서 VPC를 생성해주어야합니다. </p><p>VPC란 Virtual Private Cloud, 가상 사설 클라우드입니다. </p><p>VPC 개념은 아래 래퍼런스 참고해주세요.</p><p><a href="https://medium.com/harrythegreat/aws-%EA%B0%80%EC%9E%A5%EC%89%BD%EA%B2%8C-vpc-%EA%B0%9C%EB%85%90%EC%9E%A1%EA%B8%B0-71eef95a7098" target="_blank" rel="noopener noreferrer">[AWS] 가장쉽게 VPC 개념잡기</a></p><p>제일 이해하기 쉬웠던 VPC 설명입니다.</p><p><a href="https://www.44bits.io/ko/post/understanding_aws_vpc" target="_blank" rel="noopener noreferrer">만들면서 배우는 아마존 VPC(Amazon VPC) 입문: AWS 네트워크의 기초</a></p><p>EKS를 사용하기 위한 VPC 레퍼런스들 입니다. </p><p><a href="https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/create-public-private-vpc.html" target="_blank" rel="noopener noreferrer">Amazon EKS 클러스터에 대해 VPC 생성</a></p><p><a href="https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/network_reqs.html" target="_blank" rel="noopener noreferrer">클러스터 VPC 고려 사항</a></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="network-with-terraform">Network with Terraform<a class="hash-link" href="#network-with-terraform" title="Direct link to heading">​</a></h3><p>이제 테라폼으로 VPC를 생성해주려고 합니다. </p><p>유지보수를 위해 이전에 만든 <code>[main.tf](http://main.tf)</code> 파일에는 너무 많은 코드가 들어가지 않도록 각 설정마다 모듈로 관리하려합니다. </p><p>VPC 관련 모듈, EKS관련 모듈과 같이 관리를 통해 가독성을 높이고, 유지보수성을 높이려합니다.</p><p>VPC 모듈로 <code>network_module</code> 이라는 이름의 폴더를 생성해주었습니다. </p><p>테라폼 모듈을 3개의 파일로 관리하려합니다. </p><p><code>main.tf</code> : 모듈이 실행되는 파일</p><p><code>variables.tf</code> : 모듈의 input값을 관리하는 파일</p><p><code>outputs.tf</code> :모듈의 output값을 관리하는 파일, 만약 output이 없는 경우 해당 파일 생성을 하지 않을 수 있습니다.</p><p>해당 모듈을 통해 가용영역은 2개, 각 가용영역별로 공개, 비공개 서브넷을 하나씩 생성하여 총 4개의 서브넷으로 구성된 VPC를 생성하려합니다.</p><p>2개의 가용영역을 구성하는 이유는 AWS EKS 공식문서의 <a href="https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/network_reqs.html" target="_blank" rel="noopener noreferrer">클러스터 VPC 고려사항</a>중 </p><blockquote><p>Amazon EKS 클러스터를 생성할 때 Amazon EKS가 탄력적 네트워크 인터페이스를 배치할 수 있는 VPC 서브넷을 지정합니다. <strong>Amazon EKS는 최소 2개의 가용 영역에 서브넷이 필요하며, 노드와의 제어 플레인 통신을 용이하게 하기 위해 이러한 서브넷에 최대 4개의 네트워크 인터페이스를 생성합니다.</strong></p></blockquote><p>라는 문구가 있어 2개의 가용영역을 생성해주게 되었습니다. </p><p>조금 더 자세한 EKS VPC 네트워크는 추후에 더 공부하려합니다.</p><p>테라폼으로 AWS VPC를 생성해야하므로 AWS VPC Terraform module을 사용합니다. </p><p>AWS VPC Terraform module 공식문서</p><p><a href="https://registry.terraform.io/modules/terraform-aws-modules/vpc/aws/latest" target="_blank" rel="noopener noreferrer"></a></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="outputtf"><code>output.tf</code><a class="hash-link" href="#outputtf" title="Direct link to heading">​</a></h3><blockquote><p>여기서는 network_module을 통해 생성되는 VPC의 id와 subnet의 id를 모듈의 결과로 반환할 수 있도록 작성해줍니다.</p></blockquote><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">&quot;vpc_id&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 모듈로 생성된 vpc id입니다</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> aws_vpc.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">&quot;subnet_ids&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 모듈로 생성된 subnet의 ids입니다</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aws_subnet.public-subnet-a.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aws_subnet.public-subnet-b.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aws_subnet.private-subnet-a.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  aws_subnet.private-subnet-b.id</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">&quot;public_subnet_ids&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 모듈로 생성된 공개 subnet의 ids입니다</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">aws_subnet.public-subnet-a.id, aws_subnet.public-subnet-b.id</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token string" style="color:#e3116c">&quot;private_subnet_ids&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 모듈로 생성된 비공개 subnet의 ids입니다</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">aws_subnet.private-subnet-a.id, aws_subnet.private-subnet-b.id</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="maintf"><code>main.tf</code><a class="hash-link" href="#maintf" title="Direct link to heading">​</a></h3><blockquote><p>network_module이 실질적으로 실행되는 파일입니다.
코드가 길어 부분별로 잘라서 본문에 작성되었습니다.</p></blockquote><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">provider </span><span class="token string" style="color:#e3116c">&quot;aws&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> var.aws_region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## AWS VPC 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token string" style="color:#e3116c">&quot;aws_vpc&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;main&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cidr_block           </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> var.main_vpc_cidr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable_dns_support   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable_dns_hostnames </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Name&quot;</span><span class="token plain">                                      </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> var.vpc_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/cluster/</span><span class="token string variable" style="color:#36acaa">${var.cluster_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;shared&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>AWS 공급자 선언으로부터 시작합니다. 공급자를 선언하는 경우 테라폼이 작업을 진행할 AWS 리전이 있어야합니다. </p><p>여기서는 <code>variable.tf</code> 파일을 통한 input값에 맞추어 지정할 수 있도록 합니다.</p><p>다음은 VPC를 생성하기 위한 코드를 정의합니다. </p><p>여기서는 사이더 블록과 태그를 지정합니다. </p><aside>❓ CIDR(사이더)란?<p><a href="https://ko.wikipedia.org/wiki/%EC%82%AC%EC%9D%B4%EB%8D%94_(%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%82%B9)" target="_blank" rel="noopener noreferrer">사이더 (네트워킹) - 위키백과, 우리 모두의 백과사전</a></p><p>네트워크나 서브넷에서 허용하는 IP 주소를 정의하는 축약형 문자열로 네트워크 IP 주소 범위를 설명하는 표준 방법입니다.</p></aside><p>사이더 블록도 외부에서 값을 받아 지정할 수 있도록 변수를 활용합니다.</p><p>AWS는 VPC용 DNS서버를 지원합니다. (Route 53 Resolver)</p><p><a href="https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/vpc-dns.html" target="_blank" rel="noopener noreferrer">VPC에 대한 DNS 지원</a></p><p><code>enable_dns_support</code> : 기본 VPC에서 DNS 호스트 이름을 활성화</p><p><code>enable_dns_hostnames</code> : 기본 VPC에서 DNS 지원을 활성화</p><p>태그를 지정하는 이유는 태그 추가를 통해 리소스 그룹을 쉽게 식별하고 관리할 수 있기 때문입니다. </p><p>VPC를 쉽게 식별할 수 있도록 Name 태그를 정의하고, 쿠버네티스 클러스터를 식별하는 쿠버네티스 태그도 정의합니다. </p><p>VPC용 DNS서버를 사용하기 위해 활성화 옵션을 사용했습니다.</p><p>여기서 사용하기 위한 도메인을 생성해줍니다.</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token string" style="color:#e3116c">&quot;aws_route53_zone&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;private-zone&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${var.name}</span><span class="token string" style="color:#e3116c">.</span><span class="token string variable" style="color:#36acaa">${var.vpc_name}</span><span class="token string" style="color:#e3116c">.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  force_destroy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vpc_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> aws_vpc.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>[aws_route53_zone](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_zone)</code> 테라폼 리소스를 사용하여 도메인을 생성합니다.</p><p>다음은 서브넷 정의입니다.</p><p><code>output.tf</code> 에 선언된 것과 같이 총 4개의 서브넷을 구성해야합니다. </p><p>테라폼 aws subnet 모듈</p><p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/subnet" target="_blank" rel="noopener noreferrer"></a></p><p>서브넷을 구성하는데 필요한 값은 <code>vpc_id</code> , <code>cidr_block</code>, <code>availability_zone</code> 입니다. </p><p><code>vpc_id</code> : 서브넷이 속할 VPC의 id입니다, 위 코드를 통해 생성된 VPC id를 사용합니다</p><p><code>cidr_block</code> : 각 서브넷 별로 지정이 필요합니다, 외부에서 값을 받아 사용할 수 있도록 변수를 활용합니다.</p><p><code>availability_zone</code> : 2개의 가용영역을 사용하여 각 가용영역별로 2개의 서브넷을 구성할 예정이기 때문에
가용영역을 서브넷별로 따로 지정해주어야합니다.</p><p>이를 구현하기 위해서는 가용영역에 대한 정보가 필요합니다.</p><p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/availability_zones" target="_blank" rel="noopener noreferrer"></a></p><p><code>aws_availability_zones</code> 테라폼 데이터 소스를 사용하여 가용영역을 받아와 사용합니다.</p><p>해당 데이터 소스를 통해 받아온 가용영역 0번째 인덱스는 subnet-a, 1번째 인덱스는 subnet-b로 활용합니다.</p><p>코드로 확인하면 아래와 같습니다.</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token string" style="color:#e3116c">&quot;aws_availability_zones&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;available&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;available&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token string" style="color:#e3116c">&quot;aws_subnet&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;public-subnet-a&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_id            </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> aws_vpc.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cidr_block        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> var.public_subnet_a_cidr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  availability_zone </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data.aws_availability_zones.available.names</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Name&quot;</span><span class="token plain">                                      </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${var.vpc_name}</span><span class="token string" style="color:#e3116c">-public-subnet-a&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/cluster/</span><span class="token string variable" style="color:#36acaa">${var.cluster_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;shared&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/role/elb&quot;</span><span class="token plain">                    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token string" style="color:#e3116c">&quot;aws_subnet&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;public-subnet-b&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_id            </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> aws_vpc.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cidr_block        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> var.public_subnet_b_cidr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  availability_zone </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data.aws_availability_zones.available.names</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Name&quot;</span><span class="token plain">                                      </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${var.vpc_name}</span><span class="token string" style="color:#e3116c">-public-subnet-b&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/cluster/</span><span class="token string variable" style="color:#36acaa">${var.cluster_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;shared&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/role/elb&quot;</span><span class="token plain">                    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token string" style="color:#e3116c">&quot;aws_subnet&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;private-subnet-a&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_id            </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> aws_vpc.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cidr_block        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> var.private_subnet_a_cidr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  availability_zone </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data.aws_availability_zones.available.names</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Name&quot;</span><span class="token plain">                                      </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${var.vpc_name}</span><span class="token string" style="color:#e3116c">-private-subnet-a&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/cluster/</span><span class="token string variable" style="color:#36acaa">${var.cluster_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;shared&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/role/internal-elb&quot;</span><span class="token plain">           </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token string" style="color:#e3116c">&quot;aws_subnet&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;private-subnet-b&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_id            </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> aws_vpc.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cidr_block        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> var.private_subnet_b_cidr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  availability_zone </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data.aws_availability_zones.available.names</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Name&quot;</span><span class="token plain">                                      </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${var.vpc_name}</span><span class="token string" style="color:#e3116c">-private-subnet-b&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/cluster/</span><span class="token string variable" style="color:#36acaa">${var.cluster_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;shared&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/role/internal-elb&quot;</span><span class="token plain">           </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>관리자와 운영자 콘솔을 통해서 네트워크 리소스를 쉽게 찾을 수 있도록 Name 태그를 추가해줍니다.</p><p>EKS에서 네트워크 로드 밸런싱을 사용할 수 있도록 태그를 사용해주었습니다.</p><p>이에 대한 설명은 아래 공식문서에서 자세하게 확인할 수 있습니다</p><p><a href="https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/network-load-balancing.html" target="_blank" rel="noopener noreferrer">Amazon EKS의 네트워크 로드 밸런싱</a></p><p>4개의 서브넷을 구성한 뒤에는 AWS가 트래픽을 관리하는데 필요한 네트워크 규칙을 정의해야합니다. </p><p>서브넷에 허용할 트래픽 소스를 정의하는 라우팅 테이블을 설정하려합니다. </p><p><a href="https://ko.wikipedia.org/wiki/%EB%9D%BC%EC%9A%B0%ED%8C%85_%ED%85%8C%EC%9D%B4%EB%B8%94" target="_blank" rel="noopener noreferrer">라우팅 테이블 - 위키백과, 우리 모두의 백과사전</a></p><p>먼저 두 공개 서브넷에 대한 라우팅 규칙을 정의합니다.</p><p>인터넷에서 서브넷에 접근할 수 있도록 하기 위해서는 인터넷 게이트웨이를 사용해야합니다.</p><p>aws 인터넷 게이트웨이 공식문서</p><p><a href="https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/VPC_Internet_Gateway.html" target="_blank" rel="noopener noreferrer">인터넷 게이트웨이</a></p><div class="codeBlockContainer_J+bg language-HCL theme-code-block"><div class="codeBlockContent_csEI HCL"><pre tabindex="0" class="prism-code language-HCL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_internet_gateway&quot; &quot;igw&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_id = aws_vpc.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name = &quot;${var.vpc_name}-igw&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_route_table&quot; &quot;public-route&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_id = aws_vpc.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  route {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_block = &quot;0.0.0.0/0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gateway_id = aws_internet_gateway.igw.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Name&quot; = &quot;${var.vpc_name}-public-route&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_route_table_association&quot; &quot;public-a-association&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_id      = aws_subnet.public-subnet-a.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  route_table_id = aws_route_table.public-route.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_route_table_association&quot; &quot;public-b-association&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_id      = aws_subnet.public-subnet-b.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  route_table_id = aws_route_table.public-route.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>제일 먼저 인터넷 게이트웨이 리소스를 VPC에 추가해줍니다.</p><p>이때는 위에서 생성된 VPC에 대한 id를 활용하여 인터넷 게이트웨이를 생성해줍니다.</p><p>테라폼의 <code>[aws_internet_gateway](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/internet_gateway)</code> 리소스를 사용하여 인터넷 게이트웨이를 생성할 수 있습니다.</p><p>역시 관리자 콘솔에서 쉽게 확인할 수 있도록 태그를 알아줍니다.</p><p>그 후, 게이트웨이에서 서브넷으로 트래픽을 라우팅하는 방법을 AWS에 알리는 라우팅 규칙을 정의합니다. </p><p>그러기 위해서는 라우팅 테이블이 필요하며, 테라폼의 <code>[aws_route_table](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route_table)</code> 리소스를 사용하여 생성해줍니다.</p><p>라우팅 테이블에서는 인터넷의 모든 트래픽 (CIDR 0.0.0.0/0)을 게이트웨이를 통해 처리할 수 있도록 구성합니다.</p><p>이후 공개 서브넷과 라우팅 테이블간의 연결을 생성해줍니다. </p><p>테라폼의 <code>[aws_route_table_association](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route_table_association)</code> 리소스를 사용하여 서브넷과 라우팅 테이블을 연결할 수 있습니다.</p><p>공개 서브넷에 대한 라우팅 경로를 정의한 뒤에는 사설 서브넷에 대한 라우팅 설정을 진행해야합니다.</p><p>쿠버네티스의 파드가 EKS 서비스와 통신할 수 있도록 사설 서브넷에서 인터넷으로 나가는 경로를 지정해야합니다. </p><p>이를 위해 사설 서브넷에서 공개 서브넷에 배포된 인터넷 게이트웨이와 통신할 수 있는 방법이 필요합니다. </p><p>AWS는 이를 위해 NAT 게이트웨이 리소스를 제공합니다. </p><p><a href="https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/vpc-nat-gateway.html" target="_blank" rel="noopener noreferrer">NAT 게이트웨이</a></p><p>NAT을 생성하기 위해서는 특별한 IP 주소인 <a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html" target="_blank" rel="noopener noreferrer">EIP</a>(Elastic IP adress / 탄력적 IP 주소)를 할당해야합니다.</p><p>여기서는 2개의 EIP를 생성하여 NAT에 할당해줍니다.</p><div class="codeBlockContainer_J+bg language-HCL theme-code-block"><div class="codeBlockContent_csEI HCL"><pre tabindex="0" class="prism-code language-HCL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_eip&quot; &quot;nat-a&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Name&quot; = &quot;${var.vpc_name}-NAT-a&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_eip&quot; &quot;nat-b&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Name&quot; = &quot;${var.vpc_name}-NAT-b&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_nat_gateway&quot; &quot;nat-gw-a&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allocation_id = aws_eip.nat-a.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_id     = aws_subnet.public-subnet-a.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  depends_on    = [aws_internet_gateway.igw]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Name&quot; = &quot;${var.vpc_name}-NAT-gw-a&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_nat_gateway&quot; &quot;nat-gw-b&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allocation_id = aws_eip.nat-b.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_id     = aws_subnet.public-subnet-b.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  depends_on    = [aws_internet_gateway.igw]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Name&quot; = &quot;${var.vpc_name}-NAT-gw-b&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>[aws_eip](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eip)</code> 테라폼 리소스를 사용하여 eip를 생성해줍니다.</p><p><code>[aws_nat_gateway](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/nat_gateway)</code> 테라폼 리소스를 사용하여 생성한 eip를 할당하고 생성했던 공개서브넷을 연결해줍니다. </p><p>올바른 순서를 보장해주기 위해 위에서 생성했던 인터넷 게이트웨이에 대한 명시적 종속성을 추가해줍니다.</p><p>NAT 게이트웨이를 구성한 뒤에는 사설 서브넷(private subnet)에 대한 라우팅을 정의해줍니다.</p><div class="codeBlockContainer_J+bg language-HCL theme-code-block"><div class="codeBlockContent_csEI HCL"><pre tabindex="0" class="prism-code language-HCL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">esource &quot;aws_route_table&quot; &quot;private-route-a&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_id = aws_vpc.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  route {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_block     = &quot;0.0.0.0/0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nat_gateway_id = aws_nat_gateway.nat-gw-a.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Name&quot; = &quot;${var.vpc_name}-private-route-a&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_route_table&quot; &quot;private-route-b&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_id = aws_vpc.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  route {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_block     = &quot;0.0.0.0/0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nat_gateway_id = aws_nat_gateway.nat-gw-b.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Name&quot; = &quot;${var.vpc_name}-private-route-b&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_route_table_association&quot; &quot;private-a-association&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_id      = aws_subnet.private-subnet-a.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  route_table_id = aws_route_table.private-route-a.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;aws_route_table_association&quot; &quot;private-b-association&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_id      = aws_subnet.private-subnet-b.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  route_table_id = aws_route_table.private-route-b.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>위에서 공개 서브넷에 대한 라우팅을 정의해줄 때와 마찬가지로 테라폼의 <code>[aws_route_table](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route_table)</code> 리소스를 통해 먼저 라우팅 테이블을 구성합니다. 단 이때는 인터넷 게이트웨이가 아닌 바로 위에서 구성한 NAT 게이트웨이를 사용합니다. </p><p>라우팅 테이블을 생성한 뒤에는 테라폼의 <code>[aws_route_table_association](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route_table_association)</code> 리소스를 사용하여 사설 서브넷과 라우팅 테이블을 연결해줍니다.</p><p>여기까지 진행하였다면 테라폼을 통한 네트워크 모듈의 <code>main.tf</code> 가 끝이 났습니다.</p><p>생성된 네트워크의 모습은 아래 사진처럼 구성되었습니다.</p><p><img src="https://user-images.githubusercontent.com/38996611/149650404-5e344cc5-7cd9-4ded-8461-0e84ff3b71a5.png" alt="vpc"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="variabletf"><code>variable.tf</code><a class="hash-link" href="#variabletf" title="Direct link to heading">​</a></h3><blockquote><p><code>main.tf</code> 파일에서 사용한 변수들을 여기서 정의합니다.</p></blockquote><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">variable </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable </span><span class="token string" style="color:#e3116c">&quot;aws_region&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable </span><span class="token string" style="color:#e3116c">&quot;vpc_name&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable </span><span class="token string" style="color:#e3116c">&quot;main_vpc_cidr&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable </span><span class="token string" style="color:#e3116c">&quot;public_subnet_a_cidr&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable </span><span class="token string" style="color:#e3116c">&quot;public_subnet_b_cidr&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable </span><span class="token string" style="color:#e3116c">&quot;private_subnet_a_cidr&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable </span><span class="token string" style="color:#e3116c">&quot;private_subnet_b_cidr&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable </span><span class="token string" style="color:#e3116c">&quot;cluster_name&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="network-모듈-사용">Network 모듈 사용<a class="hash-link" href="#network-모듈-사용" title="Direct link to heading">​</a></h3><p>network 모듈을 구성했으면 이제 사용할 차례입니다. </p><p>이전 테라폼 백엔드를 선언했던 <code>main.tf</code> 파일에서 네트워크 모듈을 사용해줍니다.</p><p><code>variable.tf</code> 파일에 선언되어있는 변수들에 값을 전부 넣어주어야 합니다.</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">locals </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name              </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;data-team-infra&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region            </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ap-northeast-2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  availability_zone </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ap-northeast-2a&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  k8s_cluster_name  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cluster&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Owner       </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;aib&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Environment </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dev&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module </span><span class="token string" style="color:#e3116c">&quot;aws-network&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./network_module&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> local.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vpc_name              </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;aib_eks_vpc&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster_name          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> local.k8s_cluster_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  aws_region            </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> local.region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  main_vpc_cidr         </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.10.0.0/16&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public_subnet_a_cidr  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.10.0.0/18&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public_subnet_b_cidr  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.10.64.0/18&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private_subnet_a_cidr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.10.128.0/18&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private_subnet_b_cidr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.10.192.0/18&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>다른 모듈들에서도 공통으로 사용할 값들에 대해서 로컬 변수로 지정해줍니다.</p><p>이후 <code>network_module</code> 모듈을 사용합니다.</p><p><code>source</code> 에는 위에서 생성했던 <code>network_module</code> 의 위치를 입력해줍니다.</p><p>각 서브넷의 CIDR를 입력해줍니다. </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="마무리">마무리<a class="hash-link" href="#마무리" title="Direct link to heading">​</a></h3><p>전부 입력후 테라폼 명령어를 통해 포멧팅부터 plan까지 진행합니다.</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform </span><span class="token function" style="color:#d73a49">fmt</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform validate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform plan</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>문제없이 실행되는 것을 확인한 후 apply 해줍니다</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>테라폼이 실행된 후 VPC가 성공적으로 생성되었는지 테스트할 수 있습니다.</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">aws ec2 describe-vpcs --filters </span><span class="token assign-left variable" style="color:#36acaa">Name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">cidr,Values</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.10</span><span class="token plain">.0.0/16</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/til/docs/tags/aws">AWS</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/til/docs/tags/eks">EKS</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/til/docs/tags/terraform">Terraform</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/til/docs/tags/network">Network</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/til/docs/tags/vpc">VPC</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/til/docs/tags/datahub-with-eks">Datahub with EKS</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://wonjun0120/github.io/til/docs/docs/Datahub with EKS/TerraformNetworkModule.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/til/docs/Datahub with EKS/terraform_basic_setting"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">EKS Datahub 2 Terraform 초기 세팅</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/til/docs/Datahub with EKS/terraform_eks_module"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">EKS Datahub 4 Terraform EKS Module</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#래퍼런스" class="table-of-contents__link toc-highlight">래퍼런스</a></li><li><a href="#network-들어가기-앞서" class="table-of-contents__link toc-highlight">Network 들어가기 앞서..</a></li><li><a href="#network-with-terraform" class="table-of-contents__link toc-highlight">Network with Terraform</a></li><li><a href="#outputtf" class="table-of-contents__link toc-highlight"><code>output.tf</code></a></li><li><a href="#maintf" class="table-of-contents__link toc-highlight"><code>main.tf</code></a></li><li><a href="#variabletf" class="table-of-contents__link toc-highlight"><code>variable.tf</code></a></li><li><a href="#network-모듈-사용" class="table-of-contents__link toc-highlight">Network 모듈 사용</a></li><li><a href="#마무리" class="table-of-contents__link toc-highlight">마무리</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/til/docs/intro">Project Logs</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/til/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/wonjun0120" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/til/assets/js/runtime~main.2dd48f90.js"></script>
<script src="/til/assets/js/main.7dcddf2a.js"></script>
</body>
</html>